<!doctype html>
<link rel="stylesheet" href="../../style.css">
<title>stagit :: 4322b6b</title>
<h1><a href="../index.html" title="Back to Repository">&larr;&#xFE0E;</a> stagit :: 4322b6b</h1>
<hr>
<table id="main" cellpadding="0" cellspacing="0">
<tr class="item"><td class="linenumber"><a href="#l1" name="l1">1</a></td><td><pre><span class="commit">commit 4322b6b440cdc47f0cffb918bb35d598abe8dee1</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l2" name="l2">2</a></td><td><pre>Author: acidvegas &lt;acid.vegas@acid.vegas&gt;</pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l3" name="l3">3</a></td><td><pre>Date:   Fri Mar 27 08:10:42 2020 -0400</pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l4" name="l4">4</a></td><td><pre></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l5" name="l5">5</a></td><td><pre>    Initial commit</pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l6" name="l6">6</a></td><td><pre>---</pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l7" name="l7">7</a></td><td><pre> LICENSE   |  15 <span class="insertion">+++++</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l8" name="l8">8</a></td><td><pre> README.md |  45 <span class="insertion">++++++++++++++</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l9" name="l9">9</a></td><td><pre> stagit    | 200 <span class="insertion">++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l10" name="l10">10</a></td><td><pre> 3 files changed, 260 insertions(+)</pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l11" name="l11">11</a></td><td><pre></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l12" name="l12">12</a></td><td><pre><span class="bold">diff --git a/LICENSE b/LICENSE</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l13" name="l13">13</a></td><td><pre><span class="bold">new file mode 100644</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l14" name="l14">14</a></td><td><pre><span class="bold">index 0000000..0f72fc8</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l15" name="l15">15</a></td><td><pre><span class="bold">--- /dev/null</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l16" name="l16">16</a></td><td><pre><span class="bold">+++ b/LICENSE</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l17" name="l17">17</a></td><td><pre><span class="hunk">@@ -0,0 +1,15 @@</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l18" name="l18">18</a></td><td><pre><span class="insertion">+</span><span class="insertion">ISC License</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l19" name="l19">19</a></td><td><pre><span class="insertion">+</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l20" name="l20">20</a></td><td><pre><span class="insertion">+</span><span class="insertion">Copyright (c) 2020, acidvegas &lt;acid.vegas@acid.vegas&gt;</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l21" name="l21">21</a></td><td><pre><span class="insertion">+</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l22" name="l22">22</a></td><td><pre><span class="insertion">+</span><span class="insertion">Permission to use, copy, modify, and/or distribute this software for any</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l23" name="l23">23</a></td><td><pre><span class="insertion">+</span><span class="insertion">purpose with or without fee is hereby granted, provided that the above</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l24" name="l24">24</a></td><td><pre><span class="insertion">+</span><span class="insertion">copyright notice and this permission notice appear in all copies.</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l25" name="l25">25</a></td><td><pre><span class="insertion">+</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l26" name="l26">26</a></td><td><pre><span class="insertion">+</span><span class="insertion">THE SOFTWARE IS PROVIDED &quot;AS IS&quot; AND THE AUTHOR DISCLAIMS ALL WARRANTIES</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l27" name="l27">27</a></td><td><pre><span class="insertion">+</span><span class="insertion">WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l28" name="l28">28</a></td><td><pre><span class="insertion">+</span><span class="insertion">MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l29" name="l29">29</a></td><td><pre><span class="insertion">+</span><span class="insertion">ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l30" name="l30">30</a></td><td><pre><span class="insertion">+</span><span class="insertion">WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l31" name="l31">31</a></td><td><pre><span class="insertion">+</span><span class="insertion">ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l32" name="l32">32</a></td><td><pre><span class="insertion">+</span><span class="insertion">OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l33" name="l33">33</a></td><td><pre><span class="bold">diff --git a/README.md b/README.md</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l34" name="l34">34</a></td><td><pre><span class="bold">new file mode 100644</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l35" name="l35">35</a></td><td><pre><span class="bold">index 0000000..4732ed1</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l36" name="l36">36</a></td><td><pre><span class="bold">--- /dev/null</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l37" name="l37">37</a></td><td><pre><span class="bold">+++ b/README.md</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l38" name="l38">38</a></td><td><pre><span class="hunk">@@ -0,0 +1,45 @@</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l39" name="l39">39</a></td><td><pre><span class="insertion">+</span><span class="insertion"># stagit</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l40" name="l40">40</a></td><td><pre><span class="insertion">+</span><span class="insertion">&gt; static git page generator</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l41" name="l41">41</a></td><td><pre><span class="insertion">+</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l42" name="l42">42</a></td><td><pre><span class="insertion">+</span><span class="insertion">## Information</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l43" name="l43">43</a></td><td><pre><span class="insertion">+</span><span class="insertion">This is basically a pure shell script clone of [stagit](https://git.2f30.org/stagit/).</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l44" name="l44">44</a></td><td><pre><span class="insertion">+</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l45" name="l45">45</a></td><td><pre><span class="insertion">+</span><span class="insertion">It is meant to be hosted on [Github](https://github.com) using [Github Pages](https://pages.github.com) with a [Custom domain](https://help.github.com/en/articles/using-a-custom-domain-with-github-pages).</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l46" name="l46">46</a></td><td><pre><span class="insertion">+</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l47" name="l47">47</a></td><td><pre><span class="insertion">+</span><span class="insertion">A live demo of this script can be seen [here](https://acid.vegas).</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l48" name="l48">48</a></td><td><pre><span class="insertion">+</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l49" name="l49">49</a></td><td><pre><span class="insertion">+</span><span class="insertion">## Settings</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l50" name="l50">50</a></td><td><pre><span class="insertion">+</span><span class="insertion">| Setting          | Default        | Description                                                        |</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l51" name="l51">51</a></td><td><pre><span class="insertion">+</span><span class="insertion">| ---------------- | -------------- | ------------------------------------------------------------------ |</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l52" name="l52">52</a></td><td><pre><span class="insertion">+</span><span class="insertion">| CLONE_URL        | remote         | base url for cloning repositories *(remote = remote.origin.url)*   |</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l53" name="l53">53</a></td><td><pre><span class="insertion">+</span><span class="insertion">| CNAME            | empty          | create a CNAME file with a custom domain *(empty = do not create)* |</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l54" name="l54">54</a></td><td><pre><span class="insertion">+</span><span class="insertion">| MAX_COMMITS      | 100            | maximum number of commits to show (0 = all)                        |</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l55" name="l55">55</a></td><td><pre><span class="insertion">+</span><span class="insertion">| MAX_COMMIT_MSG   | 100            | maximum characters in a commit message to display *(0 = all)*      |</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l56" name="l56">56</a></td><td><pre><span class="insertion">+</span><span class="insertion">| MAX_COMMIT_LINES | 999            | maximum number of lines to show in a commit *(0 = all)*            |</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l57" name="l57">57</a></td><td><pre><span class="insertion">+</span><span class="insertion">| REPO_DIR         | $HOME/git      | directory containing repositories                                  |</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l58" name="l58">58</a></td><td><pre><span class="insertion">+</span><span class="insertion">| THEME            | light          | style used *(light or dark)*                                       |</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l59" name="l59">59</a></td><td><pre><span class="insertion">+</span><span class="insertion">| TITLE            | &quot;Repositories&quot; | title used on homepage                                             |</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l60" name="l60">60</a></td><td><pre><span class="insertion">+</span><span class="insertion">| WWW_DIR          | $HOME/www      | directory to output to                                             |</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l61" name="l61">61</a></td><td><pre><span class="insertion">+</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l62" name="l62">62</a></td><td><pre><span class="insertion">+</span><span class="insertion">If the `CLONE_URL` was set to `https://github.com/acidvegas/` for example, then it will display as `git clone https://github.com/acidvegas/REPO_NAME.git` on all repository indexes, otherwise if you leave it as `remote` it will just parse the remote url *(`git config --get remote.origin.url`)* for that repository. For those using the `remote` option, remote urls from Github/Gitlab that use SSH will be converted to an HTTPS url. This applies to Github/Gitlab remote urls only, so if you cloned your repositories with SSH, then people may not be able to clone your repositories!</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l63" name="l63">63</a></td><td><pre><span class="insertion">+</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l64" name="l64">64</a></td><td><pre><span class="insertion">+</span><span class="insertion">The `CNAME` option is optional if you are planning on using a custom domain with Github pages. See [here](https://help.github.com/en/articles/troubleshooting-custom-domains#github-repository-setup-errors) for more information.</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l65" name="l65">65</a></td><td><pre><span class="insertion">+</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l66" name="l66">66</a></td><td><pre><span class="insertion">+</span><span class="insertion">Lastly, stagit will ignore the `$REPO_DIR/mirrors` directory by default. To make stagit include this directory, remove `-path $REPO_DIR/mirrors -prune` from the `find` command in the source.</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l67" name="l67">67</a></td><td><pre><span class="insertion">+</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l68" name="l68">68</a></td><td><pre><span class="insertion">+</span><span class="insertion">## Todo</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l69" name="l69">69</a></td><td><pre><span class="insertion">+</span><span class="insertion">- Parse repository owner in a better way</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l70" name="l70">70</a></td><td><pre><span class="insertion">+</span><span class="insertion">- Add support for detecting organization names *(possibly using the Github/Gitlab API &amp; curl)*.</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l71" name="l71">71</a></td><td><pre><span class="insertion">+</span><span class="insertion">- Create an index per-user to view specific users repos &amp; key information.</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l72" name="l72">72</a></td><td><pre><span class="insertion">+</span><span class="insertion">- Pagination support for repos exceeding `MAX_COMMITS`.</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l73" name="l73">73</a></td><td><pre><span class="insertion">+</span><span class="insertion">- Add a footer to all pages with the last updated datetime and a link to this repository.</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l74" name="l74">74</a></td><td><pre><span class="insertion">+</span><span class="insertion">- Hook git pushes to rebuild the repositories index.</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l75" name="l75">75</a></td><td><pre><span class="insertion">+</span><span class="insertion">- Add support for displaying LICENSE/README files and convert markdown to HTML.</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l76" name="l76">76</a></td><td><pre><span class="insertion">+</span><span class="insertion">- Add support to view file contents.</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l77" name="l77">77</a></td><td><pre><span class="insertion">+</span><span class="insertion">- Colored commit logs.</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l78" name="l78">78</a></td><td><pre><span class="insertion">+</span><span class="insertion">- Fix all possible bashisms identified in source by checkbashisms.</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l79" name="l79">79</a></td><td><pre><span class="insertion">+</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l80" name="l80">80</a></td><td><pre><span class="insertion">+</span><span class="insertion">## Mirrors</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l81" name="l81">81</a></td><td><pre><span class="insertion">+</span><span class="insertion">- [acid.vegas](https://acid.vegas/stagit) *(main)*</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l82" name="l82">82</a></td><td><pre><span class="insertion">+</span><span class="insertion">- [GitHub](https://github.com/acidvegas/stagit)</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l83" name="l83">83</a></td><td><pre><span class="insertion">+</span><span class="insertion">- [GitLab](https://gitlab.com/acidvegas/stagit)</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l84" name="l84">84</a></td><td><pre><span class="bold">diff --git a/stagit b/stagit</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l85" name="l85">85</a></td><td><pre><span class="bold">new file mode 100755</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l86" name="l86">86</a></td><td><pre><span class="bold">index 0000000..b000f0d</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l87" name="l87">87</a></td><td><pre><span class="bold">--- /dev/null</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l88" name="l88">88</a></td><td><pre><span class="bold">+++ b/stagit</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l89" name="l89">89</a></td><td><pre><span class="hunk">@@ -0,0 +1,200 @@</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l90" name="l90">90</a></td><td><pre><span class="insertion">+</span><span class="insertion">#!/bin/sh</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l91" name="l91">91</a></td><td><pre><span class="insertion">+</span><span class="insertion"># developed by acidvegas (https://acid.vegas/stagit)</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l92" name="l92">92</a></td><td><pre><span class="insertion">+</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l93" name="l93">93</a></td><td><pre><span class="insertion">+</span><span class="insertion">set -e</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l94" name="l94">94</a></td><td><pre><span class="insertion">+</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l95" name="l95">95</a></td><td><pre><span class="insertion">+</span><span class="insertion">##### settings ########################################################################</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l96" name="l96">96</a></td><td><pre><span class="insertion">+</span><span class="insertion">CLONE_URL='remote'   # base url for cloning repositories ('remote' = remote.origin.url)</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l97" name="l97">97</a></td><td><pre><span class="insertion">+</span><span class="insertion">CNAME=''             # create a CNAME file with a custom domain (empty = do not create)</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l98" name="l98">98</a></td><td><pre><span class="insertion">+</span><span class="insertion">MAX_COMMITS=100      # maximum number of commits to show (0 = all)</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l99" name="l99">99</a></td><td><pre><span class="insertion">+</span><span class="insertion">MAX_COMMIT_MSG=100   # maximum characters in a commit message to display (0 = all)</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l100" name="l100">100</a></td><td><pre><span class="insertion">+</span><span class="insertion">MAX_COMMIT_LINES=999 # maximum number of lines to show in a commit (0 = all)</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l101" name="l101">101</a></td><td><pre><span class="insertion">+</span><span class="insertion">REPO_DIR=$HOME/git   # directory containing repositories</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l102" name="l102">102</a></td><td><pre><span class="insertion">+</span><span class="insertion">THEME='light'        # default style used ('light' or 'dark')</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l103" name="l103">103</a></td><td><pre><span class="insertion">+</span><span class="insertion">TITLE='Repositories' # title used on homepage</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l104" name="l104">104</a></td><td><pre><span class="insertion">+</span><span class="insertion">WWW_DIR=$HOME/www    # directory to output to</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l105" name="l105">105</a></td><td><pre><span class="insertion">+</span><span class="insertion">#######################################################################################</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l106" name="l106">106</a></td><td><pre><span class="insertion">+</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l107" name="l107">107</a></td><td><pre><span class="insertion">+</span><span class="insertion">generate_404() {</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l108" name="l108">108</a></td><td><pre><span class="insertion">+</span>	<span class="insertion">{</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l109" name="l109">109</a></td><td><pre><span class="insertion">+</span>		<span class="insertion">echo &quot;&lt;!doctype html&gt;&quot;</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l110" name="l110">110</a></td><td><pre><span class="insertion">+</span>		<span class="insertion">echo &quot;&lt;title&gt;Error&lt;/title&gt;&quot;</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l111" name="l111">111</a></td><td><pre><span class="insertion">+</span>		<span class="insertion">if [ $THEME = 'light' ]; then</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l112" name="l112">112</a></td><td><pre><span class="insertion">+</span>			<span class="insertion">echo &quot;&lt;style&gt;body{background-color:#fff;color:#000;font-family:monospace}&lt;/style&gt;&quot;</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l113" name="l113">113</a></td><td><pre><span class="insertion">+</span>		<span class="insertion">else # We have to use internal CSS here because the style.css path will differ inside directories!</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l114" name="l114">114</a></td><td><pre><span class="insertion">+</span>			<span class="insertion">echo &quot;&lt;style&gt;body{background-color:#111;color:#fff;font-family:monospace}&lt;/style&gt;&quot;</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l115" name="l115">115</a></td><td><pre><span class="insertion">+</span>		<span class="insertion">fi</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l116" name="l116">116</a></td><td><pre><span class="insertion">+</span>		<span class="insertion">echo &quot;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;enter&gt;&lt;h1&gt;404&lt;/h1&gt;&lt;/center&gt;&quot;</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l117" name="l117">117</a></td><td><pre><span class="insertion">+</span>	<span class="insertion">} &gt; $WWW_DIR/404.html</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l118" name="l118">118</a></td><td><pre><span class="insertion">+</span><span class="insertion">}</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l119" name="l119">119</a></td><td><pre><span class="insertion">+</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l120" name="l120">120</a></td><td><pre><span class="insertion">+</span><span class="insertion">generate_yml() {</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l121" name="l121">121</a></td><td><pre><span class="insertion">+</span>	<span class="insertion">{</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l122" name="l122">122</a></td><td><pre><span class="insertion">+</span>		<span class="insertion">echo &quot;pages:&quot;</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l123" name="l123">123</a></td><td><pre><span class="insertion">+</span>		<span class="insertion">echo &quot;  stage: deploy&quot;</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l124" name="l124">124</a></td><td><pre><span class="insertion">+</span>		<span class="insertion">echo &quot;  script:&quot;</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l125" name="l125">125</a></td><td><pre><span class="insertion">+</span>		<span class="insertion">echo &quot;  - mkdir .public&quot;</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l126" name="l126">126</a></td><td><pre><span class="insertion">+</span>		<span class="insertion">echo &quot;  - cp -r * .public&quot;</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l127" name="l127">127</a></td><td><pre><span class="insertion">+</span>		<span class="insertion">echo &quot;  - mv .public public&quot;</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l128" name="l128">128</a></td><td><pre><span class="insertion">+</span>		<span class="insertion">echo &quot;  artifacts:&quot;</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l129" name="l129">129</a></td><td><pre><span class="insertion">+</span>		<span class="insertion">echo &quot;    paths:&quot;</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l130" name="l130">130</a></td><td><pre><span class="insertion">+</span>		<span class="insertion">echo &quot;    - public&quot;</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l131" name="l131">131</a></td><td><pre><span class="insertion">+</span>		<span class="insertion">echo &quot;  only:&quot;</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l132" name="l132">132</a></td><td><pre><span class="insertion">+</span>		<span class="insertion">echo &quot;  - master&quot;</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l133" name="l133">133</a></td><td><pre><span class="insertion">+</span>	<span class="insertion">} &gt; $WWW_DIR/.gitlab-ci.yml</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l134" name="l134">134</a></td><td><pre><span class="insertion">+</span><span class="insertion">}</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l135" name="l135">135</a></td><td><pre><span class="insertion">+</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l136" name="l136">136</a></td><td><pre><span class="insertion">+</span><span class="insertion">generate_css() {</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l137" name="l137">137</a></td><td><pre><span class="insertion">+</span>	<span class="insertion">if [ $THEME = 'light' ]; then</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l138" name="l138">138</a></td><td><pre><span class="insertion">+</span>		<span class="insertion">{</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l139" name="l139">139</a></td><td><pre><span class="insertion">+</span>			<span class="insertion">echo &quot;a{color:blue}&quot;</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l140" name="l140">140</a></td><td><pre><span class="insertion">+</span>			<span class="insertion">echo &quot;body{background-color:#fff;color:#000;font-family:monospace;margin-top:0px}&quot;</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l141" name="l141">141</a></td><td><pre><span class="insertion">+</span>			<span class="insertion">echo &quot;code{counter-increment:line}&quot;</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l142" name="l142">142</a></td><td><pre><span class="insertion">+</span>			<span class="insertion">echo &quot;code::before{border-right:1px solid #000;color:#000;content:counter(line);display:inline-block;margin-right:.5em;padding:0 .5em;width:1.5em;-webkit-user-select:none}&quot;</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l143" name="l143">143</a></td><td><pre><span class="insertion">+</span>			<span class="insertion">echo &quot;h1{margin:0px}&quot;</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l144" name="l144">144</a></td><td><pre><span class="insertion">+</span>			<span class="insertion">echo &quot;h1 a{color:#000;text-decoration:none}&quot;</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l145" name="l145">145</a></td><td><pre><span class="insertion">+</span>			<span class="insertion">echo &quot;h4{color:#777;margin:0px}&quot;</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l146" name="l146">146</a></td><td><pre><span class="insertion">+</span>			<span class="insertion">echo &quot;h5{margin:0px;font-style:italic;font-weight:normal}&quot;</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l147" name="l147">147</a></td><td><pre><span class="insertion">+</span>			<span class="insertion">echo &quot;hr{border:none;border-bottom:1px solid #777}&quot;</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l148" name="l148">148</a></td><td><pre><span class="insertion">+</span>			<span class="insertion">echo &quot;pre{counter-reset:line}&quot;</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l149" name="l149">149</a></td><td><pre><span class="insertion">+</span>			<span class="insertion">echo &quot;.item:hover{background-color:#eee}&quot;</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l150" name="l150">150</a></td><td><pre><span class="insertion">+</span>			<span class="insertion">echo &quot;.item td{white-space:nowrap}&quot;</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l151" name="l151">151</a></td><td><pre><span class="insertion">+</span>			<span class="insertion">echo &quot;#main{border-collapse:collapse;table-layout:fixed}&quot;</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l152" name="l152">152</a></td><td><pre><span class="insertion">+</span>			<span class="insertion">echo &quot;#main td,th{padding-left:5px;padding-right:5px}&quot;</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l153" name="l153">153</a></td><td><pre><span class="insertion">+</span>			<span class="insertion">echo &quot;#navigation{color:#000;font-weight:900;text-align:left}&quot;</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l154" name="l154">154</a></td><td><pre><span class="insertion">+</span>		<span class="insertion">} &gt; $WWW_DIR/style.css</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l155" name="l155">155</a></td><td><pre><span class="insertion">+</span>	<span class="insertion">else</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l156" name="l156">156</a></td><td><pre><span class="insertion">+</span>		<span class="insertion">{</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l157" name="l157">157</a></td><td><pre><span class="insertion">+</span>			<span class="insertion">echo &quot;a{color:#8dc}&quot;</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l158" name="l158">158</a></td><td><pre><span class="insertion">+</span>			<span class="insertion">echo &quot;a:hover{color:#8cd}&quot;</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l159" name="l159">159</a></td><td><pre><span class="insertion">+</span>			<span class="insertion">echo &quot;body{background-color:#111;color:#fff;font-family:monospace;margin-top:0px}&quot;</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l160" name="l160">160</a></td><td><pre><span class="insertion">+</span>			<span class="insertion">echo &quot;code{counter-increment:line}&quot;</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l161" name="l161">161</a></td><td><pre><span class="insertion">+</span>			<span class="insertion">echo &quot;code::before{border-right:1px solid #fff;color:#fff;content:counter(line);display:inline-block;margin-right:.5em;padding:0 .5em;width:1.5em;-webkit-user-select:none}&quot;</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l162" name="l162">162</a></td><td><pre><span class="insertion">+</span>			<span class="insertion">echo &quot;h1{margin:0px}&quot;</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l163" name="l163">163</a></td><td><pre><span class="insertion">+</span>			<span class="insertion">echo &quot;h1 a{color:#fff;text-decoration:none}&quot;</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l164" name="l164">164</a></td><td><pre><span class="insertion">+</span>			<span class="insertion">echo &quot;h4{color:#777;margin:0px}&quot;</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l165" name="l165">165</a></td><td><pre><span class="insertion">+</span>			<span class="insertion">echo &quot;h5{font-style:italic;font-weight:normal;margin:0px}&quot;</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l166" name="l166">166</a></td><td><pre><span class="insertion">+</span>			<span class="insertion">echo &quot;hr{border:none;border-bottom:1px dashed #fff}&quot;</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l167" name="l167">167</a></td><td><pre><span class="insertion">+</span>			<span class="insertion">echo &quot;pre{counter-reset:line}&quot;</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l168" name="l168">168</a></td><td><pre><span class="insertion">+</span>			<span class="insertion">echo &quot;.item:hover{background-color:#1a1a1a}&quot;</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l169" name="l169">169</a></td><td><pre><span class="insertion">+</span>			<span class="insertion">echo &quot;.item td{white-space:nowrap}&quot;</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l170" name="l170">170</a></td><td><pre><span class="insertion">+</span>			<span class="insertion">echo &quot;#main{border-collapse:collapse;table-layout:fixed}&quot;</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l171" name="l171">171</a></td><td><pre><span class="insertion">+</span>			<span class="insertion">echo &quot;#main td,th{padding-left:5px;padding-right:5px}&quot;</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l172" name="l172">172</a></td><td><pre><span class="insertion">+</span>			<span class="insertion">echo &quot;#navigation{color:#fff;font-weight:900;text-align:left}&quot;</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l173" name="l173">173</a></td><td><pre><span class="insertion">+</span>		<span class="insertion">} &gt; $WWW_DIR/style.css</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l174" name="l174">174</a></td><td><pre><span class="insertion">+</span>	<span class="insertion">fi</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l175" name="l175">175</a></td><td><pre><span class="insertion">+</span><span class="insertion">}</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l176" name="l176">176</a></td><td><pre><span class="insertion">+</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l177" name="l177">177</a></td><td><pre><span class="insertion">+</span><span class="insertion">generate_index() {</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l178" name="l178">178</a></td><td><pre><span class="insertion">+</span>	<span class="insertion">{</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l179" name="l179">179</a></td><td><pre><span class="insertion">+</span>		<span class="insertion">echo &quot;&lt;!doctype html&gt;&quot;</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l180" name="l180">180</a></td><td><pre><span class="insertion">+</span>		<span class="insertion">echo &quot;&lt;link rel=\&quot;stylesheet\&quot; href=\&quot;style.css\&quot;&gt;&quot;</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l181" name="l181">181</a></td><td><pre><span class="insertion">+</span>		<span class="insertion">echo &quot;&lt;title&gt;$TITLE&lt;/title&gt;&quot;</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l182" name="l182">182</a></td><td><pre><span class="insertion">+</span>		<span class="insertion">echo &quot;&lt;h1&gt;&amp;#8962;&amp;#xFE0E; $TITLE&lt;/h1&gt;&quot;</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l183" name="l183">183</a></td><td><pre><span class="insertion">+</span>		<span class="insertion">echo &quot;&lt;hr&gt;&quot;</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l184" name="l184">184</a></td><td><pre><span class="insertion">+</span>		<span class="insertion">echo &quot;&lt;table id=\&quot;main\&quot; cellpadding=\&quot;0\&quot; cellspacing=\&quot;0\&quot;&gt;&quot;</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l185" name="l185">185</a></td><td><pre><span class="insertion">+</span>		<span class="insertion">echo &quot;&lt;tr id=\&quot;navigation\&quot;&gt;&lt;th&gt;Name&lt;/th&gt;&lt;th&gt;Description&lt;/th&gt;&lt;th&gt;Owner&lt;/th&gt;&lt;th&gt;Last commit&lt;/th&gt;&lt;/tr&gt;&quot;</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l186" name="l186">186</a></td><td><pre><span class="insertion">+</span>	<span class="insertion">} &gt; $WWW_DIR/index.html</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l187" name="l187">187</a></td><td><pre><span class="insertion">+</span><span class="insertion">}</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l188" name="l188">188</a></td><td><pre><span class="insertion">+</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l189" name="l189">189</a></td><td><pre><span class="insertion">+</span><span class="insertion">generate_repository_index() {</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l190" name="l190">190</a></td><td><pre><span class="insertion">+</span>	<span class="insertion">local REPO_NAME=$1</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l191" name="l191">191</a></td><td><pre><span class="insertion">+</span>	<span class="insertion">local REPO_URL=$2</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l192" name="l192">192</a></td><td><pre><span class="insertion">+</span>	<span class="insertion">local REPO_DESC=${@:3} # todo: fix possible bashism</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l193" name="l193">193</a></td><td><pre><span class="insertion">+</span>	<span class="insertion">mkdir -p $WWW_DIR/$REPO_NAME/commit</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l194" name="l194">194</a></td><td><pre><span class="insertion">+</span>	<span class="insertion">{</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l195" name="l195">195</a></td><td><pre><span class="insertion">+</span>		<span class="insertion">echo &quot;&lt;!doctype html&gt;&quot;</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l196" name="l196">196</a></td><td><pre><span class="insertion">+</span>		<span class="insertion">echo &quot;&lt;link rel=\&quot;stylesheet\&quot; href=\&quot;../style.css\&quot;&gt;&quot;</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l197" name="l197">197</a></td><td><pre><span class="insertion">+</span>		<span class="insertion">echo &quot;&lt;title&gt;$REPO_NAME&lt;/title&gt;&quot;</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l198" name="l198">198</a></td><td><pre><span class="insertion">+</span>		<span class="insertion">echo &quot;&lt;h1&gt;&lt;a href=\&quot;../index.html\&quot; title=\&quot;Home\&quot;&gt;&amp;#8962;&amp;#xFE0E;&lt;/a&gt; $REPO_NAME&lt;/h1&gt;&quot;</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l199" name="l199">199</a></td><td><pre><span class="insertion">+</span>		<span class="insertion">echo &quot;&lt;div style=\&quot;padding-left:30px\&quot;&gt;&quot;</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l200" name="l200">200</a></td><td><pre><span class="insertion">+</span>		<span class="insertion">echo &quot;&lt;h4&gt;$REPO_DESC&lt;/h4&gt;&quot;</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l201" name="l201">201</a></td><td><pre><span class="insertion">+</span>		<span class="insertion">echo &quot;&lt;h5&gt;git clone &lt;a href=\&quot;$REPO_URL\&quot; title=\&quot;$REPO_NAME clone URL\&quot;&gt;$REPO_URL&lt;/a&gt;&lt;/h5&gt;&quot;</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l202" name="l202">202</a></td><td><pre><span class="insertion">+</span>		<span class="insertion">echo &quot;&lt;/div&gt;&quot;</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l203" name="l203">203</a></td><td><pre><span class="insertion">+</span>		<span class="insertion">echo &quot;&lt;hr&gt;&quot;</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l204" name="l204">204</a></td><td><pre><span class="insertion">+</span>		<span class="insertion">echo &quot;&lt;table id=\&quot;main\&quot; cellpadding=\&quot;0\&quot; cellspacing=\&quot;0\&quot;&gt;&quot;</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l205" name="l205">205</a></td><td><pre><span class="insertion">+</span>		<span class="insertion">echo &quot;&lt;tr id=\&quot;navigation\&quot;&gt;&lt;th&gt;&lt;/th&gt;&lt;th&gt;Hash&lt;/th&gt;&lt;th&gt;Commit message&lt;/th&gt;&lt;th&gt;Author&lt;/th&gt;&lt;th&gt;Date&lt;/th&gt;&lt;th align=\&quot;right\&quot;&gt;Files&lt;/th&gt;&lt;th align=\&quot;right\&quot;&gt;+&lt;/th&gt;&lt;th align=\&quot;right\&quot;&gt;-&lt;/th&gt;&lt;/tr&gt;&quot;</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l206" name="l206">206</a></td><td><pre><span class="insertion">+</span>	<span class="insertion">} &gt; $WWW_DIR/$REPO_NAME/index.html</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l207" name="l207">207</a></td><td><pre><span class="insertion">+</span><span class="insertion">}</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l208" name="l208">208</a></td><td><pre><span class="insertion">+</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l209" name="l209">209</a></td><td><pre><span class="insertion">+</span><span class="insertion">generate_commit_index() {</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l210" name="l210">210</a></td><td><pre><span class="insertion">+</span>	<span class="insertion">local REPO_NAME=$1</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l211" name="l211">211</a></td><td><pre><span class="insertion">+</span>	<span class="insertion">local COMMIT_HASH=$2</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l212" name="l212">212</a></td><td><pre><span class="insertion">+</span>	<span class="insertion">{</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l213" name="l213">213</a></td><td><pre><span class="insertion">+</span>		<span class="insertion">echo &quot;&lt;!doctype html&gt;&quot;</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l214" name="l214">214</a></td><td><pre><span class="insertion">+</span>		<span class="insertion">echo &quot;&lt;link rel=\&quot;stylesheet\&quot; href=\&quot;../../style.css\&quot;&gt;&quot;</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l215" name="l215">215</a></td><td><pre><span class="insertion">+</span>		<span class="insertion">echo &quot;&lt;title&gt;$REPO_NAME :: $COMMIT_HASH&lt;/title&gt;&quot;</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l216" name="l216">216</a></td><td><pre><span class="insertion">+</span>		<span class="insertion">echo &quot;&lt;h1&gt;&lt;a href=\&quot;../index.html\&quot; title=\&quot;Back to Repository\&quot;&gt;&amp;larr;&amp;#xFE0E;&lt;/a&gt; $REPO_NAME :: $COMMIT_HASH&lt;/h1&gt;&quot;</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l217" name="l217">217</a></td><td><pre><span class="insertion">+</span>		<span class="insertion">echo &quot;&lt;hr&gt;&quot;</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l218" name="l218">218</a></td><td><pre><span class="insertion">+</span>		<span class="insertion">echo &quot;&lt;pre&gt;&quot;</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l219" name="l219">219</a></td><td><pre><span class="insertion">+</span>	<span class="insertion">} &gt; $WWW_DIR/$REPO_NAME/commit/$COMMIT_HASH.html</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l220" name="l220">220</a></td><td><pre><span class="insertion">+</span><span class="insertion">}</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l221" name="l221">221</a></td><td><pre><span class="insertion">+</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l222" name="l222">222</a></td><td><pre><span class="insertion">+</span><span class="insertion">[ ! -d $REPO_DIR ] &amp;&amp; echo &quot;'$REPO_DIR' directory does not exist&quot; &amp;&amp; exit 1</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l223" name="l223">223</a></td><td><pre><span class="insertion">+</span><span class="insertion">REPOS=$(find $REPO_DIR -type d -name mirrors -prune -o -type d -name .git -print | sort  -t '/' -k 7)</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l224" name="l224">224</a></td><td><pre><span class="insertion">+</span><span class="insertion">[ -z &quot;$REPOS&quot; ] &amp;&amp; echo &quot;'$REPO_DIR' contains no repositories&quot; &amp;&amp; exit 1</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l225" name="l225">225</a></td><td><pre><span class="insertion">+</span><span class="insertion">mkdir -p $WWW_DIR &amp;&amp; rm -rf $WWW_DIR/*</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l226" name="l226">226</a></td><td><pre><span class="insertion">+</span><span class="insertion">[ ! -z $CNAME ] &amp;&amp; echo $CNAME &gt; $WWW_DIR/CNAME</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l227" name="l227">227</a></td><td><pre><span class="insertion">+</span><span class="insertion">generate_yml &amp;&amp; generate_404 &amp;&amp; generate_css &amp;&amp; generate_index</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l228" name="l228">228</a></td><td><pre><span class="insertion">+</span><span class="insertion">for d in $REPOS; do</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l229" name="l229">229</a></td><td><pre><span class="insertion">+</span>	<span class="insertion">REPO_NAME=$(basename -s .git `git --git-dir $d config --get remote.origin.url`)</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l230" name="l230">230</a></td><td><pre><span class="insertion">+</span>	<span class="insertion">if [ -f $d/description ]; then</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l231" name="l231">231</a></td><td><pre><span class="insertion">+</span>		<span class="insertion">REPO_DESC=$(head -n 1 $d/description)</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l232" name="l232">232</a></td><td><pre><span class="insertion">+</span>		<span class="insertion">if [ &quot;$REPO_DESC&quot; = &quot;Unnamed repository; edit this file 'description' to name the repository.&quot; ]; then</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l233" name="l233">233</a></td><td><pre><span class="insertion">+</span>			<span class="insertion">echo &quot;edit description for $REPO_NAME ($d/description)&quot;</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l234" name="l234">234</a></td><td><pre><span class="insertion">+</span>			<span class="insertion">REPO_DESC=&quot;no description available&quot;</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l235" name="l235">235</a></td><td><pre><span class="insertion">+</span>		<span class="insertion">fi</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l236" name="l236">236</a></td><td><pre><span class="insertion">+</span>	<span class="insertion">else</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l237" name="l237">237</a></td><td><pre><span class="insertion">+</span>		<span class="insertion">echo &quot;missing description file for $REPO_NAME ($d/description)&quot;</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l238" name="l238">238</a></td><td><pre><span class="insertion">+</span>		<span class="insertion">REPO_DESC=&quot;no description available&quot;</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l239" name="l239">239</a></td><td><pre><span class="insertion">+</span>	<span class="insertion">fi</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l240" name="l240">240</a></td><td><pre><span class="insertion">+</span>	<span class="insertion">REPO_OWNER=$(git --git-dir $d log --reverse --pretty=format:'%an' | head -n 1) # todo: find a better way to do this &amp; handle organization name parsing</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l241" name="l241">241</a></td><td><pre><span class="insertion">+</span>	<span class="insertion">REPO_LAST_COMMIT=$(git --git-dir $d log -1 --pretty=format:'%cs')</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l242" name="l242">242</a></td><td><pre><span class="insertion">+</span>	<span class="insertion">echo &quot;&lt;tr class=\&quot;item\&quot;&gt;&lt;td&gt;&lt;a href=\&quot;$REPO_NAME\&quot; title=\&quot;$REPO_NAME\&quot;&gt;$REPO_NAME&lt;/a&gt;&lt;/td&gt;&lt;td&gt;$REPO_DESC&lt;/td&gt;&lt;td&gt;$REPO_OWNER&lt;/td&gt;&lt;td&gt;$REPO_LAST_COMMIT&lt;/td&gt;&lt;/tr&gt;&quot; &gt;&gt; $WWW_DIR/index.html</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l243" name="l243">243</a></td><td><pre><span class="insertion">+</span>	<span class="insertion">if [ $CLONE_URL = 'remote' ]; then</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l244" name="l244">244</a></td><td><pre><span class="insertion">+</span>		<span class="insertion">REPO_URL=$(git --git-dir $d config --get remote.origin.url)</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l245" name="l245">245</a></td><td><pre><span class="insertion">+</span>		<span class="insertion">REPO_URL=$(echo $REPO_URL | sed 's#git@github.com:#https://github.com/#' | sed 's#git@gitlab.com:#https://gitlab.com/#')</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l246" name="l246">246</a></td><td><pre><span class="insertion">+</span>	<span class="insertion">else</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l247" name="l247">247</a></td><td><pre><span class="insertion">+</span>		<span class="insertion">REPO_URL=$CLONE_URL/$REPO_NAME.git</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l248" name="l248">248</a></td><td><pre><span class="insertion">+</span>	<span class="insertion">fi</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l249" name="l249">249</a></td><td><pre><span class="insertion">+</span>	<span class="insertion">generate_repository_index $REPO_NAME $REPO_URL $REPO_DESC</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l250" name="l250">250</a></td><td><pre><span class="insertion">+</span>	<span class="insertion">if [ $MAX_COMMITS -eq 0 ]; then</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l251" name="l251">251</a></td><td><pre><span class="insertion">+</span>		<span class="insertion">REPO_COMMITS=$(git --git-dir $d log --all --date=format:&quot;%Y-%m-%d %H:%M&quot; --pretty=format:&quot;%G?|%GS|%GK|%h|%s|%cn|%cd&quot;)</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l252" name="l252">252</a></td><td><pre><span class="insertion">+</span>	<span class="insertion">else</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l253" name="l253">253</a></td><td><pre><span class="insertion">+</span>		<span class="insertion">REPO_COMMITS=$(git --git-dir $d log --all --date=format:&quot;%Y-%m-%d %H:%M&quot; --pretty=format:&quot;%G?|%GS|%GK|%h|%s|%cn|%cd&quot; | head -n $MAX_COMMITS)</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l254" name="l254">254</a></td><td><pre><span class="insertion">+</span>	<span class="insertion">fi</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l255" name="l255">255</a></td><td><pre><span class="insertion">+</span>	<span class="insertion">echo &quot;$REPO_COMMITS&quot; | while IFS= read -r line; do</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l256" name="l256">256</a></td><td><pre><span class="insertion">+</span>		<span class="insertion">COMMIT_SIGNED=$(echo $line | cut -d'|' -f1)</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l257" name="l257">257</a></td><td><pre><span class="insertion">+</span>		<span class="insertion">COMMIT_KEY=$(echo $line | cut -d'|' -f2)</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l258" name="l258">258</a></td><td><pre><span class="insertion">+</span>		<span class="insertion">COMMIT_KEYID=$(echo $line | cut -d'|' -f3)</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l259" name="l259">259</a></td><td><pre><span class="insertion">+</span>		<span class="insertion">if [ $COMMIT_SIGNED = 'G' ]; then</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l260" name="l260">260</a></td><td><pre><span class="insertion">+</span>			<span class="insertion">COMMIT_SIGNED=&quot;&lt;span style=\&quot;color:green\&quot; title=\&quot;$COMMIT_KEY&amp;#13;$COMMIT_KEYID\&quot;&gt;&amp;#128274;&amp;#xFE0E;&lt;/span&gt;&quot;</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l261" name="l261">261</a></td><td><pre><span class="insertion">+</span>		<span class="insertion">elif [ $COMMIT_SIGNED = 'B' ] || [ $COMMIT_SIGNED = 'U' ]  || [ $COMMIT_SIGNED = 'X' ] || [ $COMMIT_SIGNED = 'Y' ] || [ $COMMIT_SIGNED = 'R' ]; then</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l262" name="l262">262</a></td><td><pre><span class="insertion">+</span>			<span class="insertion">COMMIT_SIGNED=&quot;&lt;span style=\&quot;color:red\&quot; title=\&quot;$COMMIT_KEY&amp;#13;$COMMIT_KEYID&amp;#13;key is bad, invalid, expired, or revoked\&quot;&gt;&amp;#128274;&amp;#xFE0E;&lt;/span&gt;&quot;</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l263" name="l263">263</a></td><td><pre><span class="insertion">+</span>		<span class="insertion">else</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l264" name="l264">264</a></td><td><pre><span class="insertion">+</span>			<span class="insertion">COMMIT_SIGNED=&quot;&quot;</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l265" name="l265">265</a></td><td><pre><span class="insertion">+</span>		<span class="insertion">fi</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l266" name="l266">266</a></td><td><pre><span class="insertion">+</span>		<span class="insertion">COMMIT_HASH=$(echo $line | cut -d'|' -f4)</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l267" name="l267">267</a></td><td><pre><span class="insertion">+</span>		<span class="insertion">COMMIT_MESSAGE=$(echo $line | cut -d'|' -f5 | sed 's/&amp;/\&amp;amp;/g;s/&lt;/\&amp;lt;/g;s/&gt;/\&amp;gt;/g;s/&quot;/\&amp;quot;/g;')</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l268" name="l268">268</a></td><td><pre><span class="insertion">+</span>		<span class="insertion">if [ $MAX_COMMIT_MSG -ne 0 -a ${#COMMIT_MESSAGE} -gt $MAX_COMMIT_MSG ]; then</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l269" name="l269">269</a></td><td><pre><span class="insertion">+</span>			<span class="insertion">COMMIT_MESSAGE=${COMMIT_MESSAGE:0:$MAX_COMMIT_MSG}... # todo: fix possible bashism</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l270" name="l270">270</a></td><td><pre><span class="insertion">+</span>		<span class="insertion">fi</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l271" name="l271">271</a></td><td><pre><span class="insertion">+</span>		<span class="insertion">COMMIT_AUTHOR=$(echo $line | cut -d'|' -f6)</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l272" name="l272">272</a></td><td><pre><span class="insertion">+</span>		<span class="insertion">COMMIT_DATE=$(echo $line | cut -d'|' -f7)</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l273" name="l273">273</a></td><td><pre><span class="insertion">+</span>		<span class="insertion">COMMIT_SUMMARY=$(git --git-dir $d show $COMMIT_HASH --stat | grep -E &quot;fil(e|es) changed&quot; | awk '{files+=$1; inserted+=$4; deleted+=$6} END {printf &quot;%s|+%s|-%s&quot;, files, inserted, deleted }')</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l274" name="l274">274</a></td><td><pre><span class="insertion">+</span>		<span class="insertion">COMMIT_FILES=$(echo $COMMIT_SUMMARY | cut -d'|' -f1)</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l275" name="l275">275</a></td><td><pre><span class="insertion">+</span>		<span class="insertion">COMMIT_INSERTIONS=$(echo $COMMIT_SUMMARY | cut -d'|' -f2)</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l276" name="l276">276</a></td><td><pre><span class="insertion">+</span>		<span class="insertion">COMMIT_DELETIONS=$(echo $COMMIT_SUMMARY | cut -d'|' -f3)</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l277" name="l277">277</a></td><td><pre><span class="insertion">+</span>		<span class="insertion">echo &quot;&lt;tr class=\&quot;item\&quot;&gt;&lt;td&gt;$COMMIT_SIGNED&lt;/td&gt;&lt;td&gt;&lt;a href=\&quot;commit/$COMMIT_HASH.html\&quot; title=\&quot;View this commit\&quot;&gt;$COMMIT_HASH&lt;/a&gt;&lt;/td&gt;&lt;td&gt;$COMMIT_MESSAGE&lt;/td&gt;&lt;td&gt;$COMMIT_AUTHOR&lt;/td&gt;&lt;td&gt;$COMMIT_DATE&lt;/td&gt;&lt;td align=\&quot;right\&quot;&gt;$COMMIT_FILES&lt;/td&gt;&lt;td align=\&quot;right\&quot;&gt;$COMMIT_INSERTIONS&lt;/td&gt;&lt;td align=\&quot;right\&quot;&gt;$COMMIT_DELETIONS&lt;/td&gt;&lt;/tr&gt;&quot; &gt;&gt; $WWW_DIR/$REPO_NAME/index.html</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l278" name="l278">278</a></td><td><pre><span class="insertion">+</span>		<span class="insertion">generate_commit_index $REPO_NAME $COMMIT_HASH</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l279" name="l279">279</a></td><td><pre><span class="insertion">+</span>		<span class="insertion">COMMIT_DIFF=$(git --git-dir $d show $COMMIT_HASH) # todo: convert terminal colors to html (script ; commmand ; exit)</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l280" name="l280">280</a></td><td><pre><span class="insertion">+</span>		<span class="insertion">if [ $MAX_COMMIT_LINES -ne 0 -a $(echo &quot;$COMMIT_DIFF&quot; | wc -l) -gt $MAX_COMMIT_LINES ]; then</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l281" name="l281">281</a></td><td><pre><span class="insertion">+</span>			<span class="insertion">COMMIT_DIFF=$(echo &quot;$COMMIT_DIFF&quot; | head -n $MAX_COMMIT_LINES)</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l282" name="l282">282</a></td><td><pre><span class="insertion">+</span>		<span class="insertion">fi</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l283" name="l283">283</a></td><td><pre><span class="insertion">+</span>		<span class="insertion">COMMIT_DIFF=$(echo &quot;$COMMIT_DIFF&quot; | sed 's/&amp;/\&amp;amp;/g;s/&lt;/\&amp;lt;/g;s/&gt;/\&amp;gt;/g;s/&quot;/\&amp;quot;/g;' | tr -d '\r')</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l284" name="l284">284</a></td><td><pre><span class="insertion">+</span>		<span class="insertion">echo &quot;$COMMIT_DIFF&quot; | while IFS= read -r line; do</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l285" name="l285">285</a></td><td><pre><span class="insertion">+</span>			<span class="insertion">echo &quot;&lt;code&gt;$line&lt;/code&gt;&quot; &gt;&gt; $WWW_DIR/$REPO_NAME/commit/$COMMIT_HASH.html</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l286" name="l286">286</a></td><td><pre><span class="insertion">+</span>		<span class="insertion">done</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l287" name="l287">287</a></td><td><pre><span class="insertion">+</span>		<span class="insertion">echo &quot;&lt;/pre&gt;&quot; &gt;&gt; $WWW_DIR/$REPO_NAME/commit/$COMMIT_HASH.html</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l288" name="l288">288</a></td><td><pre><span class="insertion">+</span>	<span class="insertion">done</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l289" name="l289">289</a></td><td><pre><span class="insertion">+</span><span class="insertion">done</span></pre></td></tr>
</table></pre>
