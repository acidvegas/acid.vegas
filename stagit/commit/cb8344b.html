<!doctype html>
<link rel="stylesheet" href="../../style.css">
<title>stagit :: cb8344b</title>
<h1><a href="../index.html" title="Back to Repository">&larr;&#xFE0E;</a> stagit :: cb8344b</h1>
<hr>
<table id="main" cellpadding="0" cellspacing="0">
<tr class="item"><td class="linenumber"><a href="#l1" name="l1">1</a></td><td><pre><span class="commit">commit cb8344bae6df17d2a767996a795d421e7690af02</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l2" name="l2">2</a></td><td><pre>Author: acidvegas &lt;acid.vegas@acid.vegas&gt;</pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l3" name="l3">3</a></td><td><pre>Date:   Sat May 2 01:10:32 2020 -0400</pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l4" name="l4">4</a></td><td><pre></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l5" name="l5">5</a></td><td><pre>    Fixed nullbyte errors and added footers</pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l6" name="l6">6</a></td><td><pre>---</pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l7" name="l7">7</a></td><td><pre> README.md | 10 <span class="insertion">+++++</span><span class="deletion">-----</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l8" name="l8">8</a></td><td><pre> stagit    | 25 <span class="insertion">+++++++++++++++++++</span><span class="deletion">------</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l9" name="l9">9</a></td><td><pre> 2 files changed, 24 insertions(+), 11 deletions(-)</pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l10" name="l10">10</a></td><td><pre></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l11" name="l11">11</a></td><td><pre><span class="bold">diff --git a/README.md b/README.md</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l12" name="l12">12</a></td><td><pre><span class="bold">index f607129..9d5a98f 100644</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l13" name="l13">13</a></td><td><pre><span class="bold">--- a/README.md</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l14" name="l14">14</a></td><td><pre><span class="bold">+++ b/README.md</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l15" name="l15">15</a></td><td><pre><span class="hunk">@@ -27,11 +27,11 @@</span> </span>The `CNAME` option is optional if you are planning on using a custom domain with</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l16" name="l16">16</a></td><td><pre> Lastly, stagit will ignore the `$REPO_DIR/mirrors` directory by default. To make stagit include this directory, remove `-path $REPO_DIR/mirrors -prune` from the `find` command in the source.</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l17" name="l17">17</a></td><td><pre> </span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l18" name="l18">18</a></td><td><pre> ## Todo</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l19" name="l19">19</a></td><td><pre><span class="deletion">-- Add a footer to all pages with the last updated datetime and a link to this repository.</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l20" name="l20">20</a></td><td><pre><span class="deletion">-- Hook git pushes to rebuild the repositories index.</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l21" name="l21">21</a></td><td><pre><span class="deletion">-- Add support for displaying LICENSE/README files and convert markdown to HTML.</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l22" name="l22">22</a></td><td><pre><span class="deletion">-- Add support to view file contents *(have to detect all non-binary files to exclude images, etc)*.</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l23" name="l23">23</a></td><td><pre><span class="deletion">-- Fix all possible bashisms identified in source by checkbashisms.</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l24" name="l24">24</a></td><td><pre><span class="insertion">+</span><span class="insertion">- Support for using hosting on Gitlab.</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l25" name="l25">25</a></td><td><pre><span class="insertion">+</span><span class="insertion">- Git push hook.</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l26" name="l26">26</a></td><td><pre><span class="insertion">+</span><span class="insertion">- Support for displaying LICENSE/README files and convert markdown to HTML. *(`find . -type f -not -path '*/\.git/*' -exec grep -I -q . {} \; -print`)*</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l27" name="l27">27</a></td><td><pre><span class="insertion">+</span><span class="insertion">- Support to view files and content.</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l28" name="l28">28</a></td><td><pre><span class="insertion">+</span><span class="insertion">- Fix bashisms identified by checkbashisms.</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l29" name="l29">29</a></td><td><pre> </span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l30" name="l30">30</a></td><td><pre> ## Mirrors</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l31" name="l31">31</a></td><td><pre> - [acid.vegas](https://acid.vegas/stagit) *(main)*</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l32" name="l32">32</a></td><td><pre><span class="bold">diff --git a/stagit b/stagit</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l33" name="l33">33</a></td><td><pre><span class="bold">index 54b7c2c..f882935 100755</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l34" name="l34">34</a></td><td><pre><span class="bold">--- a/stagit</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l35" name="l35">35</a></td><td><pre><span class="bold">+++ b/stagit</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l36" name="l36">36</a></td><td><pre><span class="hunk">@@ -46,6 +46,8 @@</span> </span>generate_css() {</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l37" name="l37">37</a></td><td><pre> 		echo &quot;.item td{white-space:nowrap}&quot;</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l38" name="l38">38</a></td><td><pre> 		echo &quot;.linenumber{text-align:right;-moz-user-select:-moz-none;-khtml-user-select: none;-webkit-user-select:none}&quot;</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l39" name="l39">39</a></td><td><pre> 		echo &quot;.linenumber a{text-decoration:none}&quot;</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l40" name="l40">40</a></td><td><pre><span class="insertion">+</span>		<span class="insertion">echo &quot;#footer{border-top:1px dashed #fff;color:#444;font-size:smaller;margin-top:10px;padding-top:5px;width:100%}&quot;</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l41" name="l41">41</a></td><td><pre><span class="insertion">+</span>		<span class="insertion">echo &quot;#footer a{color:#aaa;text-decoration:none}&quot;</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l42" name="l42">42</a></td><td><pre> 		echo &quot;#main{border-collapse:collapse;table-layout:fixed}&quot;</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l43" name="l43">43</a></td><td><pre> 		echo &quot;#main td,th{padding-left:5px;padding-right:5px}&quot;</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l44" name="l44">44</a></td><td><pre> 		echo &quot;#navigation{color:#fff;font-weight:900;text-align:left}&quot;</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l45" name="l45">45</a></td><td><pre><span class="hunk">@@ -98,6 +100,11 @@</span> </span>generate_commit_index() {</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l46" name="l46">46</a></td><td><pre> 	} &gt; $WWW_DIR/$REPO_NAME/commit/$COMMIT_HASH.html</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l47" name="l47">47</a></td><td><pre> }</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l48" name="l48">48</a></td><td><pre> </span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l49" name="l49">49</a></td><td><pre><span class="insertion">+</span><span class="insertion">generate_footer() {</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l50" name="l50">50</a></td><td><pre><span class="insertion">+</span>	<span class="insertion">local DATE=$(date +&quot;%m/%d/%y&quot;)</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l51" name="l51">51</a></td><td><pre><span class="insertion">+</span>	<span class="insertion">echo &quot;&lt;div id=\&quot;footer\&quot;&gt;site generated by &lt;a href=\&quot;https://github.com/acidvegas/stagit\&quot; target=\&quot;_blank\&quot;&gt;stagit&lt;/a&gt; on &lt;a href=\&quot;#\&quot;&gt;$DATE&lt;/a&gt;&lt;/div&gt;&quot; &gt;&gt; $1</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l52" name="l52">52</a></td><td><pre><span class="insertion">+</span><span class="insertion">}</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l53" name="l53">53</a></td><td><pre><span class="insertion">+</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l54" name="l54">54</a></td><td><pre> [ ! -d $REPO_DIR ] &amp;&amp; echo &quot;'$REPO_DIR' directory does not exist&quot; &amp;&amp; exit 1</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l55" name="l55">55</a></td><td><pre> REPOS=$(find $REPO_DIR -type d -name mirrors -prune -o -type d -name .git -print | sort  -t '/' -k 7)</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l56" name="l56">56</a></td><td><pre> [ -z &quot;$REPOS&quot; ] &amp;&amp; echo &quot;'$REPO_DIR' contains no repositories&quot; &amp;&amp; exit 1</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l57" name="l57">57</a></td><td><pre><span class="hunk">@@ -116,7 +123,7 @@</span> </span>for d in $REPOS; do</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l58" name="l58">58</a></td><td><pre> 		echo &quot;missing description file for $REPO_NAME ($d/description)&quot;</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l59" name="l59">59</a></td><td><pre> 		REPO_DESC=&quot;no description available&quot;</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l60" name="l60">60</a></td><td><pre> 	fi</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l61" name="l61">61</a></td><td><pre><span class="deletion">-	REPO_OWNER=$(git --git-dir $d log --reverse --pretty=format:'%an' | head -n 1) # todo: find a better way to do this &amp; handle organization name parsing</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l62" name="l62">62</a></td><td><pre><span class="insertion">+</span>	<span class="insertion">REPO_OWNER=$(git --git-dir $d log --reverse --pretty=format:'%an' | head -n 1)</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l63" name="l63">63</a></td><td><pre> 	REPO_LAST_COMMIT=$(git --git-dir $d log -1 --pretty=format:'%cs')</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l64" name="l64">64</a></td><td><pre> 	echo &quot;&lt;tr class=\&quot;item\&quot;&gt;&lt;td&gt;&lt;a href=\&quot;$REPO_NAME\&quot; title=\&quot;$REPO_NAME\&quot;&gt;$REPO_NAME&lt;/a&gt;&lt;/td&gt;&lt;td&gt;$REPO_DESC&lt;/td&gt;&lt;td&gt;$REPO_OWNER&lt;/td&gt;&lt;td&gt;$REPO_LAST_COMMIT&lt;/td&gt;&lt;/tr&gt;&quot; &gt;&gt; $WWW_DIR/index.html</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l65" name="l65">65</a></td><td><pre> 	if [ $CLONE_URL = 'remote' ]; then</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l66" name="l66">66</a></td><td><pre><span class="hunk">@@ -155,7 +162,7 @@</span> </span>for d in $REPOS; do</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l67" name="l67">67</a></td><td><pre> 		COMMIT_DELETIONS=$(echo $COMMIT_SUMMARY | cut -d'|' -f3)</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l68" name="l68">68</a></td><td><pre> 		echo &quot;&lt;tr class=\&quot;item\&quot;&gt;&lt;td&gt;$COMMIT_SIGNED&lt;/td&gt;&lt;td&gt;&lt;a href=\&quot;commit/$COMMIT_HASH.html\&quot; title=\&quot;View this commit\&quot;&gt;$COMMIT_HASH&lt;/a&gt;&lt;/td&gt;&lt;td&gt;$COMMIT_MESSAGE&lt;/td&gt;&lt;td&gt;$COMMIT_AUTHOR&lt;/td&gt;&lt;td&gt;$COMMIT_DATE&lt;/td&gt;&lt;td align=\&quot;right\&quot;&gt;$COMMIT_FILES&lt;/td&gt;&lt;td align=\&quot;right\&quot;&gt;$COMMIT_INSERTIONS&lt;/td&gt;&lt;td align=\&quot;right\&quot;&gt;$COMMIT_DELETIONS&lt;/td&gt;&lt;/tr&gt;&quot; &gt;&gt; $WWW_DIR/$REPO_NAME/index.html</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l69" name="l69">69</a></td><td><pre> 		generate_commit_index $REPO_NAME $COMMIT_HASH</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l70" name="l70">70</a></td><td><pre> 		if [ $MAX_COMMIT_LINES -ne 0 -a $(echo &quot;$COMMIT_DIFF&quot; | wc -l) -gt $MAX_COMMIT_LINES ]; then</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l71" name="l71">71</a></td><td><pre> 			COMMIT_DIFF=$(echo &quot;$COMMIT_DIFF&quot; | head -n $MAX_COMMIT_LINES)</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l72" name="l72">72</a></td><td><pre> 		fi</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l73" name="l73">73</a></td><td><pre><span class="hunk">@@ -163,10 +170,16 @@</span> </span>for d in $REPOS; do</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l74" name="l74">74</a></td><td><pre> 		COMMIT_DIFF=$(echo &quot;$COMMIT_DIFF&quot; | sed 's/\[31m/&lt;span class=&quot;deletion&quot;&gt;/g; s/\[1\;31m/&lt;span class=&quot;remote&quot;&gt;/g; s/\[32m/&lt;span class=&quot;insertion&quot;&gt;/g; s/\[1\;32m/&lt;span class=&quot;branch&quot;&gt;/g; s/\[33m/&lt;span class=&quot;commit&quot;&gt;/g; s/\[36m/&lt;span class=&quot;hunk&quot;&gt;/g; s/\[1\;36m/&lt;span class=&quot;reference&quot;&gt;/g; s/\[1m/&lt;span class=&quot;bold&quot;&gt;/g; s/\[m/&lt;\/span&gt;/g')</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l75" name="l75">75</a></td><td><pre> 		COUNT=1</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l76" name="l76">76</a></td><td><pre> 		echo &quot;$COMMIT_DIFF&quot; | while IFS= read -r line; do</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l77" name="l77">77</a></td><td><pre><span class="deletion">-				echo &quot;&lt;tr class=\&quot;item\&quot;&gt;&lt;td class=\&quot;linenumber\&quot;&gt;&lt;a href=\&quot;#l$COUNT\&quot; name=\&quot;l$COUNT\&quot;&gt;$COUNT&lt;/a&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;$line&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&quot; &gt;&gt; $WWW_DIR/$REPO_NAME/commit/$COMMIT_HASH.html</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l78" name="l78">78</a></td><td><pre><span class="deletion">-				COUNT=`expr $COUNT + 1`</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l79" name="l79">79</a></td><td><pre><span class="deletion">-			fi</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l80" name="l80">80</a></td><td><pre><span class="insertion">+</span>			<span class="insertion">echo &quot;&lt;tr class=\&quot;item\&quot;&gt;&lt;td class=\&quot;linenumber\&quot;&gt;&lt;a href=\&quot;#l$COUNT\&quot; name=\&quot;l$COUNT\&quot;&gt;$COUNT&lt;/a&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;$line&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&quot; &gt;&gt; $WWW_DIR/$REPO_NAME/commit/$COMMIT_HASH.html</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l81" name="l81">81</a></td><td><pre><span class="insertion">+</span>			<span class="insertion">COUNT=`expr $COUNT + 1`</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l82" name="l82">82</a></td><td><pre><span class="insertion">+</span>			<span class="insertion">#fi</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l83" name="l83">83</a></td><td><pre> 		done</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l84" name="l84">84</a></td><td><pre><span class="insertion">+</span>		<span class="insertion">echo &quot;&lt;/table&gt;&quot; &gt;&gt; $WWW_DIR/$REPO_NAME/commit/$COMMIT_HASH.html</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l85" name="l85">85</a></td><td><pre><span class="insertion">+</span>		<span class="insertion">generate_footer $WWW_DIR/$REPO_NAME/commit/$COMMIT_HASH.html</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l86" name="l86">86</a></td><td><pre> 	done</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l87" name="l87">87</a></td><td><pre><span class="insertion">+</span>	<span class="insertion">echo &quot;&lt;/table&gt;&quot; &gt;&gt; $WWW_DIR/$REPO_NAME/index.html</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l88" name="l88">88</a></td><td><pre><span class="insertion">+</span>	<span class="insertion">generate_footer $WWW_DIR/$REPO_NAME/index.html</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l89" name="l89">89</a></td><td><pre> done</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l90" name="l90">90</a></td><td><pre><span class="insertion">+</span><span class="insertion">echo &quot;&lt;/table&gt;&quot; &gt;&gt; $WWW_DIR/index.html</span></pre></td></tr>
<tr class="item"><td class="linenumber"><a href="#l91" name="l91">91</a></td><td><pre><span class="insertion">+</span><span class="insertion">generate_footer $WWW_DIR/index.html</span></pre></td></tr>
</table>
<div id="footer">site generated by <a href="https://github.com/acidvegas/stagit" target="_blank">stagit</a> on <a href="#">05/03/20</a></div>
